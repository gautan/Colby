<mxfile host="app.diagrams.net" modified="2026-02-11T00:00:00.000Z" agent="Claude" version="24.0.0" type="device">
  <diagram id="go-proxy-swimlane" name="Go Proxy Flow">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="1300" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- ===== TITLE ===== -->
        <mxCell id="title" value="Go Proxy — Request Flow" style="text;html=1;fontSize=18;fontStyle=1;align=center;" vertex="1" parent="1">
          <mxGeometry x="300" y="10" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="subtitle" value="cmd/proxy/main.go  →  middleware/*  →  handlers/*  →  upstream" style="text;html=1;fontSize=11;fontColor=#999999;align=center;" vertex="1" parent="1">
          <mxGeometry x="230" y="35" width="440" height="20" as="geometry" />
        </mxCell>

        <!-- ===== SWIMLANES ===== -->
        <mxCell id="lane1" value="Client" style="swimlane;startSize=25;fontStyle=1;fontSize=13;fillColor=#dae8fc;strokeColor=#6c8ebf;swimlaneLine=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="70" width="150" height="1180" as="geometry" />
        </mxCell>
        <mxCell id="lane2" value="Middleware" style="swimlane;startSize=25;fontStyle=1;fontSize=13;fillColor=#fff2cc;strokeColor=#d6b656;swimlaneLine=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="190" y="70" width="330" height="1180" as="geometry" />
        </mxCell>
        <mxCell id="lane3" value="Handlers" style="swimlane;startSize=25;fontStyle=1;fontSize=13;fillColor=#f8cecc;strokeColor=#b85450;swimlaneLine=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="530" y="70" width="260" height="1180" as="geometry" />
        </mxCell>
        <mxCell id="lane4" value="Upstream" style="swimlane;startSize=25;fontStyle=1;fontSize=13;fillColor=#e1d5e7;strokeColor=#9673a6;swimlaneLine=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="800" y="70" width="150" height="1180" as="geometry" />
        </mxCell>

        <!-- ===== CLIENT: REQUEST ===== -->
        <mxCell id="req" value="HTTP Request" style="rounded=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="45" y="120" width="120" height="40" as="geometry" />
        </mxCell>

        <!-- ===== ONREQUEST LABEL ===== -->
        <mxCell id="onreq-label" value="OnRequest" style="text;fontSize=10;fontStyle=2;fontColor=#b0981a;align=left;" vertex="1" parent="1">
          <mxGeometry x="200" y="100" width="80" height="20" as="geometry" />
        </mxCell>

        <!-- ===== MW 1: LOGGING ===== -->
        <mxCell id="mw1" value="Logging" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="120" width="170" height="36" as="geometry" />
        </mxCell>
        <mxCell id="mw1-sub" value="logging.go" style="text;fontSize=9;fontColor=#999999;align=center;" vertex="1" parent="1">
          <mxGeometry x="270" y="156" width="170" height="14" as="geometry" />
        </mxCell>

        <!-- ===== MW 2: AUTH ===== -->
        <mxCell id="mw2" value="Auth" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="195" width="170" height="36" as="geometry" />
        </mxCell>
        <mxCell id="mw2-sub" value="auth.go — basic / bearer / api_key" style="text;fontSize=9;fontColor=#999999;align=center;" vertex="1" parent="1">
          <mxGeometry x="270" y="231" width="170" height="14" as="geometry" />
        </mxCell>
        <mxCell id="mw2-err" value="407" style="ellipse;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="460" y="197" width="40" height="32" as="geometry" />
        </mxCell>

        <!-- ===== MW 3: RATE LIMIT ===== -->
        <mxCell id="mw3" value="Rate Limit" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="270" width="170" height="36" as="geometry" />
        </mxCell>
        <mxCell id="mw3-sub" value="ratelimit.go — token bucket per IP" style="text;fontSize=9;fontColor=#999999;align=center;" vertex="1" parent="1">
          <mxGeometry x="270" y="306" width="170" height="14" as="geometry" />
        </mxCell>
        <mxCell id="mw3-err" value="429" style="ellipse;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="460" y="272" width="40" height="32" as="geometry" />
        </mxCell>

        <!-- ===== MW 4: HEADERS ===== -->
        <mxCell id="mw4" value="Headers" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="345" width="170" height="36" as="geometry" />
        </mxCell>
        <mxCell id="mw4-sub" value="headers.go — add/remove req headers" style="text;fontSize=9;fontColor=#999999;align=center;" vertex="1" parent="1">
          <mxGeometry x="270" y="381" width="170" height="14" as="geometry" />
        </mxCell>

        <!-- ===== MW 5: REWRITE ===== -->
        <mxCell id="mw5" value="URL Rewrite" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="420" width="170" height="36" as="geometry" />
        </mxCell>
        <mxCell id="mw5-sub" value="rewrite.go — regex match/replace" style="text;fontSize=9;fontColor=#999999;align=center;" vertex="1" parent="1">
          <mxGeometry x="270" y="456" width="170" height="14" as="geometry" />
        </mxCell>

        <!-- ===== MW 6: PROVIDER ===== -->
        <mxCell id="mw6" value="Provider Route" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="495" width="170" height="36" as="geometry" />
        </mxCell>
        <mxCell id="mw6-sub" value="rewrite.go — /{CP}/path → target host" style="text;fontSize=9;fontColor=#999999;align=center;" vertex="1" parent="1">
          <mxGeometry x="270" y="531" width="170" height="14" as="geometry" />
        </mxCell>

        <!-- ===== HANDLER: BLOCKLIST ===== -->
        <mxCell id="h1" value="BlockList" style="rounded=1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="580" y="580" width="170" height="36" as="geometry" />
        </mxCell>
        <mxCell id="h1-sub" value="blocklist.go — wildcard domain match" style="text;fontSize=9;fontColor=#999999;align=center;" vertex="1" parent="1">
          <mxGeometry x="580" y="616" width="170" height="14" as="geometry" />
        </mxCell>
        <mxCell id="h1-err" value="403" style="ellipse;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="555" y="640" width="40" height="32" as="geometry" />
        </mxCell>

        <!-- ===== HANDLER: ALLOWLIST ===== -->
        <mxCell id="h2" value="AllowList" style="rounded=1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="580" y="690" width="170" height="36" as="geometry" />
        </mxCell>
        <mxCell id="h2-sub" value="blocklist.go — whitelist mode" style="text;fontSize=9;fontColor=#999999;align=center;" vertex="1" parent="1">
          <mxGeometry x="580" y="726" width="170" height="14" as="geometry" />
        </mxCell>

        <!-- ===== UPSTREAM ===== -->
        <mxCell id="up" value="Target&#xa;Server" style="rounded=1;whiteSpace=wrap;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="835" y="770" width="90" height="50" as="geometry" />
        </mxCell>

        <!-- ===== ONRESPONSE LABEL ===== -->
        <mxCell id="onres-label" value="OnResponse" style="text;fontSize=10;fontStyle=2;fontColor=#b0981a;align=left;" vertex="1" parent="1">
          <mxGeometry x="200" y="870" width="80" height="20" as="geometry" />
        </mxCell>

        <!-- ===== RESPONSE: HEADERS ===== -->
        <mxCell id="rmw1" value="Headers" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="895" width="170" height="36" as="geometry" />
        </mxCell>
        <mxCell id="rmw1-sub" value="headers.go — add/remove resp headers" style="text;fontSize=9;fontColor=#999999;align=center;" vertex="1" parent="1">
          <mxGeometry x="270" y="931" width="170" height="14" as="geometry" />
        </mxCell>

        <!-- ===== RESPONSE: LOGGING ===== -->
        <mxCell id="rmw2" value="Logging" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="965" width="170" height="36" as="geometry" />
        </mxCell>
        <mxCell id="rmw2-sub" value="logging.go — status, duration" style="text;fontSize=9;fontColor=#999999;align=center;" vertex="1" parent="1">
          <mxGeometry x="270" y="1001" width="170" height="14" as="geometry" />
        </mxCell>

        <!-- ===== RESPONSE: MODIFIER ===== -->
        <mxCell id="rh1" value="ResponseModifier" style="rounded=1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="580" y="1040" width="170" height="36" as="geometry" />
        </mxCell>
        <mxCell id="rh1-sub" value="response.go — strip Server header" style="text;fontSize=9;fontColor=#999999;align=center;" vertex="1" parent="1">
          <mxGeometry x="580" y="1076" width="170" height="14" as="geometry" />
        </mxCell>

        <!-- ===== CLIENT: RESPONSE ===== -->
        <mxCell id="resp" value="HTTP Response" style="rounded=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="45" y="1140" width="120" height="40" as="geometry" />
        </mxCell>

        <!-- ============================================================ -->
        <!-- ===== ARROWS — HAPPY PATH ===== -->
        <!-- ============================================================ -->

        <!-- Client → Logging -->
        <mxCell id="a01" style="endArrow=block;endFill=1;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="req" target="mw1" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Logging → Auth -->
        <mxCell id="a12" style="endArrow=block;endFill=1;" edge="1" source="mw1" target="mw2" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Auth → RateLimit -->
        <mxCell id="a23" style="endArrow=block;endFill=1;" edge="1" source="mw2" target="mw3" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- RateLimit → Headers -->
        <mxCell id="a34" style="endArrow=block;endFill=1;" edge="1" source="mw3" target="mw4" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Headers → Rewrite -->
        <mxCell id="a45" style="endArrow=block;endFill=1;" edge="1" source="mw4" target="mw5" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Rewrite → Provider -->
        <mxCell id="a56" style="endArrow=block;endFill=1;" edge="1" source="mw5" target="mw6" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Provider → BlockList -->
        <mxCell id="a67" style="endArrow=block;endFill=1;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="mw6" target="h1" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- BlockList → AllowList -->
        <mxCell id="a78" style="endArrow=block;endFill=1;" edge="1" source="h1" target="h2" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- AllowList → Upstream -->
        <mxCell id="a89" style="endArrow=block;endFill=1;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="h2" target="up" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Upstream → Resp Headers -->
        <mxCell id="a910" style="endArrow=block;endFill=1;strokeWidth=1.5;strokeColor=#9673a6;" edge="1" source="up" target="rmw1" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Resp Headers → Resp Logging -->
        <mxCell id="a1011" style="endArrow=block;endFill=1;" edge="1" source="rmw1" target="rmw2" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Resp Logging → ResponseModifier -->
        <mxCell id="a1112" style="endArrow=block;endFill=1;" edge="1" source="rmw2" target="rh1" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- ResponseModifier → Client Response -->
        <mxCell id="a1213" style="endArrow=block;endFill=1;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="rh1" target="resp" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- ===== ARROWS — REJECT ===== -->
        <!-- Auth fail -->
        <mxCell id="e1" value="" style="endArrow=block;endFill=1;dashed=1;strokeColor=#b85450;" edge="1" source="mw2" target="mw2-err" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <!-- RateLimit fail -->
        <mxCell id="e2" value="" style="endArrow=block;endFill=1;dashed=1;strokeColor=#b85450;" edge="1" source="mw3" target="mw3-err" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <!-- BlockList fail -->
        <mxCell id="e3" value="" style="endArrow=block;endFill=1;dashed=1;strokeColor=#b85450;" edge="1" source="h1" target="h1-err" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- ===== PHASE SEPARATORS ===== -->
        <mxCell id="sep1" value="" style="shape=line;strokeColor=#CCCCCC;strokeWidth=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="560" width="920" height="1" as="geometry" />
        </mxCell>
        <mxCell id="sep1-label" value="▼  forward to upstream  ▼" style="text;fontSize=9;fontColor=#AAAAAA;fontStyle=2;align=center;" vertex="1" parent="1">
          <mxGeometry x="350" y="548" width="170" height="16" as="geometry" />
        </mxCell>

        <mxCell id="sep2" value="" style="shape=line;strokeColor=#CCCCCC;strokeWidth=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="855" width="920" height="1" as="geometry" />
        </mxCell>
        <mxCell id="sep2-label" value="▼  response back  ▼" style="text;fontSize=9;fontColor=#AAAAAA;fontStyle=2;align=center;" vertex="1" parent="1">
          <mxGeometry x="350" y="843" width="170" height="16" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
